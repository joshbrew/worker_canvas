(()=>{var D=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var l=g(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]),j=g(["deltaX","deltaY"]),B=g(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]),G=g(["alpha","beta","gamma","absolute","webkitCompassHeading","webkitCompassAccuracy"]),K=g(["acceleration","accelerationIncludingGravity","rotationRate","interval"]);function X(t,e,n){for(let a of e)n[a]=t[a]}function g(t){return function(n,a){let r={type:n.type};X(n,t,r),a(r)}}function Y(t,e,n){n&&t.preventDefault&&t.preventDefault()}function A(t,e){let n={type:t.type};n.isTrusted=t.isTrusted,n.bubbles=t.bubbles,n.cancelBubble=t.cancelBubble,n.cancelable=t.cancelable,n.composed=t.composed,n.defaultPrevent=t.defaultPrevented,n.eventPhase=t.eventPhase,n.returnValue=t.returnValue,n.currentTarget=t.currentTarget.id?t.currentTarget.id:t.currentTarget.constructor.name,n.target=n.currentTarget,n.srcElement=n.currentTarget,e(n)}function $(t,e,n){n&&t.preventDefault&&t.preventDefault(),j(t,e)}function x(t,e,n){n&&t.preventDefault&&t.preventDefault();let a=[],r={type:t.type,touches:a};for(let s=0;s<t.touches.length;++s){let o=t.touches[s];a.push({pageX:o.pageX,pageY:o.pageY})}e(r)}var m=1,W={};for(;m<222;)W[m]=!0,m++;function P(t,e,n){let{keyCode:a}=t;W[a]&&(n&&t.preventDefault&&(a<110||a>123)&&t.preventDefault(),B(t,e))}var c={contextmenu:Y,mousedown:l,mousemove:l,mouseup:l,pointerdown:l,pointermove:l,pointerup:l,pointerlockchange:l,webkitpointerlockchange:l,focus:A,blur:A,pointerout:l,touchstart:x,touchmove:x,touchend:x,wheel:$,keydown:P,keyup:P,deviceorientation:G,devicemotion:K};function p(t,e,n,a){n||(n="proxy"+Math.floor(Math.random()*1e15));let r=i=>{e?e.postMessage({route:"handleProxyEvent",args:[i,n]}):M(i,n)},s=Object.entries(c);for(let[i,h]of s)t.addEventListener(i,function(F){h(F,r,a)});c.keydown&&globalThis.addEventListener("keydown",function(i){c.keydown(i,r,a)}),c.keyup&&globalThis.addEventListener("keyup",function(i){c.keyup(i,r,a)}),c.devicemotion&&globalThis.addEventListener("devicemotion",function(i){c.keyup(i,r,a)}),c.deviceorientation&&globalThis.addEventListener("deviceorientation",function(i){c.keyup(i,r,a)});let o=()=>{let i=t.getBoundingClientRect();r({type:"resize",left:i.left,top:i.top,width:t.clientWidth,height:t.clientHeight})};return o(),globalThis.addEventListener("resize",o),n}var C=class{__listeners;addEventListener(e,n){this.__listeners===void 0&&(this.__listeners={});let a=this.__listeners;a[e]===void 0&&(a[e]=[]),a[e].indexOf(n)===-1&&a[e].push(n)}hasEventListener(e,n){if(this.__listeners===void 0)return!1;let a=this.__listeners;return a[e]!==void 0&&a[e].indexOf(n)!==-1}removeEventListener(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e];if(r!==void 0){let s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e.type];if(r!==void 0){n?e.target=n:e.target=this;let s=r.slice(0);for(let o=0,i=s.length;o<i;o++)s[o].call(this,e)}}};function S(){}var b=class extends C{__listeners={};proxied;style={};width;left;right;top;height;constructor(){super(),this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}setPointerCapture=()=>{};releasePointerCapture=()=>{};getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height});handleEvent=e=>{e.type==="resize"&&(this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),e.preventDefault=S,e.stopPropagation=S,this.dispatchEvent(e,this.proxied)};focus(){}blur(){}},u=class{targets={};constructor(){globalThis.document||(globalThis.document={elementFromPoint:(...e)=>this.targets[Object.keys(this.targets)[0]].proxied})}makeProxy=(e,n)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let a;this.targets[e]?a=this.targets[e]:(a=new b,this.targets[e]=a),typeof n=="object"&&(n.proxy=a,a.proxied=n,typeof WorkerGlobalScope<"u"&&(n.style=a.style),a.width&&(n.style.width=a.width+"px",n.clientWidth=a.width),a.height&&(n.style.height=a.height+"px",n.clientHeight=a.height),n.setPointerCapture=a.setPointerCapture.bind(a),n.releasePointerCapture=a.releasePointerCapture.bind(a),n.getBoundingClientRect=a.getBoundingClientRect.bind(a),n.addEventListener=a.addEventListener.bind(a),n.removeEventListener=a.removeEventListener.bind(a),n.handleEvent=a.handleEvent.bind(a),n.dispatchEvent=a.dispatchEvent.bind(a),n.focus=a.focus.bind(a),n.blur=a.blur.bind(a))};getProxy=e=>this.targets[e];handleEvent=(e,n)=>{if(this.targets[n]||this.makeProxy(n),this.targets[n])return this.targets[n].handleEvent(e),!0}};function q(t,e){return this?.__node?.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new u),this.__node.graph.ProxyManager.makeProxy(t,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new u),globalThis.ProxyManager.makeProxy(t,e)),t}function M(t,e){if(this?.__node?.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new u),this.__node.graph.ProxyManager.handleEvent(t,e))return t}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new u),globalThis.ProxyManager.handleEvent(t,e))return t}var y={initProxyElement:p,makeProxy:q,handleProxyEvent:M};var w={},k;if(typeof process<"u")try{typeof w<"u"&&(globalThis.__filename=fileURLToPath(w.url),globalThis.__dirname=fileURLToPath(new URL(".",w.url))),k=D("path").join(process.cwd(),__dirname,"canvas.worker.js")}catch{}else{let e=globalThis.location.href.split("/");e.pop(),e=e.join("/"),k=e+"/canvas.worker.js"}var T=k;function z(t){if(t.worker===!0&&(t.worker=T),t.worker){let e=t.worker,n=t.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete t.worker,delete t.route,N(e,t,n)}else return p(t.canvas,void 0,t._id,t.preventDefault),V(t)}function N(t,e,n){if(!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let a=e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let r={route:n||"setupCanvas",args:{...e,canvas:a}};this?.__node?.graph?this.__node.graph.run("initProxyElement",e.canvas,t,e._id,e.preventDefault):p(e.canvas,t,e._id,e.preventDefault),e.draw&&(typeof e.draw=="function"?r.args.draw=e.draw.toString():r.args.draw=e.draw),e.update&&(typeof e.update=="function"?r.args.update=e.update.toString():r.args.update=e.update),e.init&&(typeof e.init=="function"?r.args.init=e.init.toString():r.args.init=e.init),e.clear&&(typeof e.clear=="function"?r.args.clear=e.clear.toString():r.args.clear=e.clear);let s=[a];return e.transfer&&(s.push(...e.transfer),delete e.transfer),t.postMessage(r,s),{_id:e._id,width:e.width,height:e.height,worker:t,draw:(i,h)=>{t.postMessage({route:"drawFrame",args:[i,e._id]},h)},update:(i,h)=>{t.postMessage({route:"updateCanvas",args:[i,e._id]},h)},clear:()=>{t.postMessage({route:"clearCanvas",args:e._id})},init:()=>{t.postMessage({route:"initCanvas",args:e._id})},stop:()=>{t.postMessage({route:"stopAnim",args:e._id})},start:()=>{t.postMessage({route:"startAnim",args:e._id})},set:(i,h)=>{t.postMessage({route:"setDraw",args:[i,e._id]},h)},terminate:()=>{t.terminate()}}}function v(t,e){let n;if(this?.__node?.graph?e?n=this.__node.graph.CANVASES?.[t._id]:t._id?n=this.__node.graph.CANVASES?.[t._id]:n=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e||t._id?n=globalThis.CANVASES?.[t._id]:n=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],n)return t.canvas&&(n.canvas=t.canvas,this?.__node?.graph?this.__node.graph.run("makeProxy",n._id,n.canvas):y.makeProxy(n._id,n.canvas)),typeof t.context=="string"?n.context=n.canvas.getContext(t.context):t.context&&(n.context=t.context),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),typeof t.draw=="string"&&(t.draw=d(t.draw)),typeof t.draw=="function"&&(n.draw=t.draw.bind(t)),typeof t.update=="string"&&(t.update=d(t.update)),typeof t.update=="function"&&(n.update=t.update.bind(t)),typeof t.init=="string"&&(t.init=d(t.init)),typeof t.init=="function"&&(n.init=t.init.bind(t)),typeof t.clear=="string"&&(t.clear=d(t.clear)),typeof t.clear=="function"&&(n.clear=t.clear.bind(t)),t._id}function V(t){this?.__node?.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=t;if(t._id?e._id=t._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof t.context=="string"?e.context=t.canvas.getContext(t.context):e.context=t.context,"animating"in t?e.animating=t.animating:e.animating=!0,this?.__node?.graph?.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if(globalThis.CANVASES?.[e._id])v(e);else if(this?.__node?.graph&&(e.graph=this.__node.graph,e.__node||(e.__node={}),e.__node.tag||(e.__node.tag=e._id),e=this.__node.graph.add(e),e.__addOndisconnected=()=>{e.stop(),delete this.__node.graph.CANVASES[e._id]}),this?.__node?.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,this?.__node?.graph?this.__node.graph.run("makeProxy",e._id,e.canvas):y.makeProxy(e._id,e.canvas),t.width&&(e.canvas.width=t.width),t.height&&(e.canvas.height=t.height),typeof e.draw=="string"?e.draw=d(e.draw):typeof e.draw=="function"&&(e.draw=e.draw.bind(e)),typeof e.update=="string"?e.update=d(e.update):typeof e.update=="function"&&(e.update=e.update.bind(e)),typeof e.init=="string"?e.init=d(e.init):typeof e.init=="function"&&(e.init=e.init.bind(e)),typeof e.clear=="string"?e.clear=d(e.clear):typeof e.clear=="function"&&(e.clear=e.clear.bind(e)),typeof e.init=="function"&&e.init(e,e.canvas,e.context),e.stop=()=>{_(e._id)},e.start=n=>{E(e._id,n)},e.set=n=>{v(n,e._id)},typeof e.draw=="function"&&e.animating){let n=(a,r,s)=>{a.animating&&(a.draw(a,r,s),requestAnimationFrame(()=>{n(a,r,s)}))};n(e,e.canvas,e.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?e._id:{_id:t._id,width:t.width,height:t.height,draw:a=>{H(a,t._id)},update:a=>{R(a,t._id)},clear:()=>{L(t._id)},init:()=>{O(t._id)},stop:()=>{_(t._id)},start:()=>{E(t._id)},set:a=>{v(a,t._id)},terminate:()=>{this.__node?.graph?this.__node.graph.remove(t._id):(_(t._id),this?.__node?.graph?delete this.__node.graph.CANVASES[e._id]:delete globalThis.CANVASES[e._id])}}}function H(t,e){let n=f.call(this,e);if(n&&(t&&Object.assign(n,t),n.draw))return n.draw(n,n.canvas,n.context),e}function L(t){let e=f.call(this,t);if(e?.clear)return e.clear(e,e.canvas,e.context),t}function O(t){let e=f.call(this,t);if(e?.init)return e.init(e,e.canvas,e.context),t}function R(t,e){let n=f.call(this,e);if(n?.update)return n.update(n,n.canvas,n.context,t),e}function U(t,e){let n=f.call(this,e);if(n&&t)return Object.assign(n,t),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),e}function E(t,e){let n=f.call(this,t);if(n.animating=!0,n&&e)return typeof e=="string"&&(e=d(e)),typeof e=="function"&&(n.draw=e),t;if(typeof n?.draw=="function"){let a=(r,s,o)=>{r.animating&&(r.draw(r,s,o),requestAnimationFrame(()=>{a(r,s,o)}))};return typeof n.clear=="function"&&n.clear(n,n.canvas,n.context),typeof n.init=="function"&&n.init(n,n.canvas,n.context),a(n,n.canvas,n.context),t}}function _(t){let e=f.call(this,t);if(e)return e.animating=!1,typeof e.clear=="function"&&requestAnimationFrame(e.clear(e,e.canvas,e.context)),t}function f(t){let e;return this?.__node?.graph?t?e=this.__node.graph.CANVASES?.[t]:e=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:t?e=globalThis.CANVASES?.[t]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e}var te={...y,Renderer:z,transferCanvas:N,setupCanvas:V,setDraw:v,drawFrame:H,clearCanvas:L,initCanvas:O,updateCanvas:R,setProps:U,startAnim:E,stopAnim:_,getCanvas:f};function d(t=""){let e=o=>o.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),a=(o=>{let i=o.indexOf("=>")+1;return i<=0&&(i=o.indexOf("){")),i<=0&&(i=o.indexOf(") {")),o.slice(0,o.indexOf("{",i)+1)})(t),r=e(t),s;if(a.includes("function")){let o=a.split("(")[1].split(")")[0];s=new Function(o,r)}else if(a.substring(0,6)===r.substring(0,6)){let o=a.split("(")[1].split(")")[0];s=new Function(o,r.substring(r.indexOf("{")+1,r.length-1))}else try{s=(0,eval)(a+r+"}")}catch{}return s}})();
