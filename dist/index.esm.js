var F=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var l=w(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]),R=w(["deltaX","deltaY"]),j=w(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function E(t,e){let n={type:t.type};n.isTrusted=t.isTrusted,n.bubbles=t.bubbles,n.cancelBubble=t.cancelBubble,n.cancelable=t.cancelable,n.composed=t.composed,n.defaultPrevent=t.defaultPrevented,n.eventPhase=t.eventPhase,n.returnValue=t.returnValue,n.currentTarget=t.currentTarget.id?t.currentTarget.id:t.currentTarget.constructor.name,n.target=n.currentTarget,n.srcElement=n.currentTarget,e(n)}function B(t,e,n){n&&t.preventDefault&&t.preventDefault(),R(t,e)}function G(t,e,n){n&&t.preventDefault&&t.preventDefault()}function K(t,e,n){for(let a of e)n[a]=t[a]}function w(t){return function(n,a){let r={type:n.type};K(n,t,r),a(r)}}function _(t,e,n){n&&t.preventDefault&&t.preventDefault();let a=[],r={type:t.type,touches:a};for(let i=0;i<t.touches.length;++i){let s=t.touches[i];a.push({pageX:s.pageX,pageY:s.pageY})}e(r)}var x=1,S={};for(;x<222;)S[x]=!0,x++;function A(t,e,n){let{keyCode:a}=t;S[a]&&(n&&t.preventDefault&&(a<110||a>123)&&t.preventDefault(),j(t,e))}var u={contextmenu:G,mousedown:l,mousemove:l,mouseup:l,pointerdown:l,pointermove:l,pointerup:l,pointerlockchange:l,webkitpointerlockchange:l,focus:E,blur:E,pointerout:l,touchstart:_,touchmove:_,touchend:_,wheel:B,keydown:A,keyup:A};function g(t,e,n,a){n||(n="proxy"+Math.floor(Math.random()*1e15));let r=o=>{e?e.postMessage({route:"handleProxyEvent",args:[o,n]}):W(o,n)},i=Object.entries(u);for(let[o,f]of i)t.addEventListener(o,function(D){f(D,r,a)});u.keydown&&globalThis.addEventListener("keydown",function(o){u.keydown(o,r,a)}),u.keyup&&globalThis.addEventListener("keyup",function(o){u.keyup(o,r,a)});let s=()=>{let o=t.getBoundingClientRect();r({type:"resize",left:o.left,top:o.top,width:t.clientWidth,height:t.clientHeight})};return s(),globalThis.addEventListener("resize",s),n}var C=class{__listeners;addEventListener(e,n){this.__listeners===void 0&&(this.__listeners={});let a=this.__listeners;a[e]===void 0&&(a[e]=[]),a[e].indexOf(n)===-1&&a[e].push(n)}hasEventListener(e,n){if(this.__listeners===void 0)return!1;let a=this.__listeners;return a[e]!==void 0&&a[e].indexOf(n)!==-1}removeEventListener(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e];if(r!==void 0){let i=r.indexOf(n);i!==-1&&r.splice(i,1)}}dispatchEvent(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e.type];if(r!==void 0){n?e.target=n:e.target=this;let i=r.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e)}}};function P(){}var m=class extends C{__listeners={};proxied;style={};width;left;right;top;height;constructor(){super(),this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}setPointerCapture=()=>{};releasePointerCapture=()=>{};getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height});handleEvent=e=>{e.type==="resize"&&(this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),e.preventDefault=P,e.stopPropagation=P,this.dispatchEvent(e,this.proxied)};focus(){}blur(){}},h=class{targets={};constructor(){globalThis.document||(globalThis.document={elementFromPoint:(...e)=>this.targets[Object.keys(this.targets)[0]].proxied})}makeProxy=(e,n)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let a;this.targets[e]?a=this.targets[e]:(a=new m,this.targets[e]=a),typeof n=="object"&&(n.proxy=a,a.proxied=n,typeof WorkerGlobalScope<"u"&&(n.style=a.style),a.width&&(n.style.width=a.width+"px",n.clientWidth=a.width),a.height&&(n.style.height=a.height+"px",n.clientHeight=a.height),n.setPointerCapture=a.setPointerCapture.bind(a),n.releasePointerCapture=a.releasePointerCapture.bind(a),n.getBoundingClientRect=a.getBoundingClientRect.bind(a),n.addEventListener=a.addEventListener.bind(a),n.removeEventListener=a.removeEventListener.bind(a),n.handleEvent=a.handleEvent.bind(a),n.dispatchEvent=a.dispatchEvent.bind(a),n.focus=a.focus.bind(a),n.blur=a.blur.bind(a))};getProxy=e=>this.targets[e];handleEvent=(e,n)=>{if(this.targets[n]||this.makeProxy(n),this.targets[n])return this.targets[n].handleEvent(e),!0}};function X(t,e){return this?.__node?.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new h),this.__node.graph.ProxyManager.makeProxy(t,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new h),globalThis.ProxyManager.makeProxy(t,e)),t}function W(t,e){if(this?.__node?.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new h),this.__node.graph.ProxyManager.handleEvent(t,e))return t}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new h),globalThis.ProxyManager.handleEvent(t,e))return t}var p={initProxyElement:g,makeProxy:X,handleProxyEvent:W};var b;if(typeof process<"u")try{typeof import.meta<"u"&&(globalThis.__filename=fileURLToPath(import.meta.url),globalThis.__dirname=fileURLToPath(new URL(".",import.meta.url))),b=F("path").join(process.cwd(),__dirname,"canvas.worker.js")}catch{}else{let e=globalThis.location.href.split("/");e.pop(),e=e.join("/"),b=e+"/canvas.worker.js"}var M=b;function Y(t){if(t.worker===!0&&(t.worker=M),t.worker){let e=t.worker,n=t.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete t.worker,delete t.route,N(e,t,n)}else return g(t.canvas,void 0,t._id,t.preventDefault),T(t)}function N(t,e,n){if(!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let a=e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let r={route:n||"setupCanvas",args:{...e,canvas:a}};this?.__node?.graph?this.__node.graph.run("initProxyElement",e.canvas,t,e._id,e.preventDefault):g(e.canvas,t,e._id,e.preventDefault),e.draw&&(typeof e.draw=="function"?r.args.draw=e.draw.toString():r.args.draw=e.draw),e.update&&(typeof e.update=="function"?r.args.update=e.update.toString():r.args.update=e.update),e.init&&(typeof e.init=="function"?r.args.init=e.init.toString():r.args.init=e.init),e.clear&&(typeof e.clear=="function"?r.args.clear=e.clear.toString():r.args.clear=e.clear);let i=[a];return e.transfer&&(i.push(...e.transfer),delete e.transfer),t.postMessage(r,i),{_id:e._id,width:e.width,height:e.height,worker:t,draw:(o,f)=>{t.postMessage({route:"drawFrame",args:[o,e._id]},f)},update:(o,f)=>{t.postMessage({route:"updateCanvas",args:[o,e._id]},f)},clear:()=>{t.postMessage({route:"clearCanvas",args:e._id})},init:()=>{t.postMessage({route:"initCanvas",args:e._id})},stop:()=>{t.postMessage({route:"stopAnim",args:e._id})},start:()=>{t.postMessage({route:"startAnim",args:e._id})},set:(o,f)=>{t.postMessage({route:"setDraw",args:[o,e._id]},f)},terminate:()=>{t.terminate()}}}function y(t,e){let n;if(this?.__node?.graph?e?n=this.__node.graph.CANVASES?.[t._id]:t._id?n=this.__node.graph.CANVASES?.[t._id]:n=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e||t._id?n=globalThis.CANVASES?.[t._id]:n=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],n)return t.canvas&&(n.canvas=t.canvas,this?.__node?.graph?this.__node.graph.run("makeProxy",n._id,n.canvas):p.makeProxy(n._id,n.canvas)),typeof t.context=="string"?n.context=n.canvas.getContext(t.context):t.context&&(n.context=t.context),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),typeof t.draw=="string"&&(t.draw=c(t.draw)),typeof t.draw=="function"&&(n.draw=t.draw.bind(t)),typeof t.update=="string"&&(t.update=c(t.update)),typeof t.update=="function"&&(n.update=t.update.bind(t)),typeof t.init=="string"&&(t.init=c(t.init)),typeof t.init=="function"&&(n.init=t.init.bind(t)),typeof t.clear=="string"&&(t.clear=c(t.clear)),typeof t.clear=="function"&&(n.clear=t.clear.bind(t)),t._id}function T(t){this?.__node?.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=t;if(t._id?e._id=t._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof t.context=="string"?e.context=t.canvas.getContext(t.context):e.context=t.context,"animating"in t?e.animating=t.animating:e.animating=!0,this?.__node?.graph?.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if(globalThis.CANVASES?.[e._id])y(e);else if(this?.__node?.graph&&(e.graph=this.__node.graph,e.__node||(e.__node={}),e.__node.tag||(e.__node.tag=e._id),e=this.__node.graph.add(e),e.__addOndisconnected=()=>{e.stop(),delete this.__node.graph.CANVASES[e._id]}),this?.__node?.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,this?.__node?.graph?this.__node.graph.run("makeProxy",e._id,e.canvas):p.makeProxy(e._id,e.canvas),t.width&&(e.canvas.width=t.width),t.height&&(e.canvas.height=t.height),typeof e.draw=="string"?e.draw=c(e.draw):typeof e.draw=="function"&&(e.draw=e.draw.bind(e)),typeof e.update=="string"?e.update=c(e.update):typeof e.update=="function"&&(e.update=e.update.bind(e)),typeof e.init=="string"?e.init=c(e.init):typeof e.init=="function"&&(e.init=e.init.bind(e)),typeof e.clear=="string"?e.clear=c(e.clear):typeof e.clear=="function"&&(e.clear=e.clear.bind(e)),typeof e.init=="function"&&e.init(e,e.canvas,e.context),e.stop=()=>{v(e._id)},e.start=n=>{k(e._id,n)},e.set=n=>{y(n,e._id)},typeof e.draw=="function"&&e.animating){let n=(a,r,i)=>{a.animating&&(a.draw(a,r,i),requestAnimationFrame(()=>{n(a,r,i)}))};n(e,e.canvas,e.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?e._id:{_id:t._id,width:t.width,height:t.height,draw:a=>{V(a,t._id)},update:a=>{O(a,t._id)},clear:()=>{L(t._id)},init:()=>{H(t._id)},stop:()=>{v(t._id)},start:()=>{k(t._id)},set:a=>{y(a,t._id)},terminate:()=>{this.__node?.graph?this.__node.graph.remove(t._id):(v(t._id),this?.__node?.graph?delete this.__node.graph.CANVASES[e._id]:delete globalThis.CANVASES[e._id])}}}function V(t,e){let n=d.call(this,e);if(n&&(t&&Object.assign(n,t),n.draw))return n.draw(n,n.canvas,n.context),e}function L(t){let e=d.call(this,t);if(e?.clear)return e.clear(e,e.canvas,e.context),t}function H(t){let e=d.call(this,t);if(e?.init)return e.init(e,e.canvas,e.context),t}function O(t,e){let n=d.call(this,e);if(n?.update)return n.update(n,n.canvas,n.context,t),e}function $(t,e){let n=d.call(this,e);if(n&&t)return Object.assign(n,t),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),e}function k(t,e){let n=d.call(this,t);if(n.animating=!0,n&&e)return typeof e=="string"&&(e=c(e)),typeof e=="function"&&(n.draw=e),t;if(typeof n?.draw=="function"){let a=(r,i,s)=>{r.animating&&(r.draw(r,i,s),requestAnimationFrame(()=>{a(r,i,s)}))};return typeof n.clear=="function"&&n.clear(n,n.canvas,n.context),typeof n.init=="function"&&n.init(n,n.canvas,n.context),a(n,n.canvas,n.context),t}}function v(t){let e=d.call(this,t);if(e)return e.animating=!1,typeof e.clear=="function"&&requestAnimationFrame(e.clear(e,e.canvas,e.context)),t}function d(t){let e;return this?.__node?.graph?t?e=this.__node.graph.CANVASES?.[t]:e=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:t?e=globalThis.CANVASES?.[t]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e}var Q={...p,Renderer:Y,transferCanvas:N,setupCanvas:T,setDraw:y,drawFrame:V,clearCanvas:L,initCanvas:H,updateCanvas:O,setProps:$,startAnim:k,stopAnim:v,getCanvas:d};function c(t=""){let e=s=>s.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),a=(s=>{let o=s.indexOf("=>")+1;return o<=0&&(o=s.indexOf("){")),o<=0&&(o=s.indexOf(") {")),s.slice(0,s.indexOf("{",o)+1)})(t),r=e(t),i;if(a.includes("function")){let s=a.split("(")[1].split(")")[0];i=new Function(s,r)}else if(a.substring(0,6)===r.substring(0,6)){let s=a.split("(")[1].split(")")[0];i=new Function(s,r.substring(r.indexOf("{")+1,r.length-1))}else try{i=(0,eval)(a+r+"}")}catch{}return i}export{m as ElementProxyReceiver,C as EventDispatcher,h as ProxyManager,Y as Renderer,L as clearCanvas,V as drawFrame,u as eventHandlers,d as getCanvas,H as initCanvas,g as initProxyElement,p as proxyElementWorkerRoutes,y as setDraw,$ as setProps,T as setupCanvas,k as startAnim,v as stopAnim,N as transferCanvas,O as updateCanvas,Q as workerCanvasRoutes};
